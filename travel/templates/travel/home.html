{% extends 'travel/base.html' %}

{% block content %}
<!-- Enhanced Hero Section with Parallax Effect -->
<div class="hero-section position-relative overflow-hidden">
    <div class="hero-bg"></div>
    <div class="hero-overlay"></div>
    <div class="container position-relative">
        <div class="row min-vh-75 align-items-center text-center">
            <div class="col-12">
                <div class="hero-content animate-fade-in">
                    <h1 class="display-3 fw-bold text-white mb-4 animate-slide-up">
                        Discover Your Next 
                        <span class="text-gradient">Adventure</span>
                    </h1>
                    <p class="lead text-white-75 mb-5 mx-auto animate-slide-up" style="max-width: 600px; animation-delay: 0.2s;">
                        Explore breathtaking destinations, book unforgettable experiences, and create memories that last a lifetime with our curated travel packages.
                    </p>
                    
                    <!-- Ultra-Modern Search Component -->
                    <div class="ultra-modern-search-container">  
     
                        <form method="get" action="{% url 'advanced_search' %}" id="modernSearchForm">
                            <!-- Quick Search Mode (Default) -->
                            <div id="quickSearchMode" class="search-mode active">
                                <!-- AI-Powered Main Search Bar -->
                                <div class="ai-search-container mb-4">
                                    <div class="ai-search-wrapper">
                                        <div class="search-input-container">
                                            <div class="search-input-prefix">
                                                <div class="ai-indicator">
                                                    <div class="ai-pulse"></div>
                                                    <i class="fas fa-brain"></i>
                                                </div>
                                            </div>
                                            <input type="text" class="ai-search-input" 
                                                   id="aiDestination" name="destination" 
                                                   placeholder="Tell me what kind of adventure you're looking for..." 
                                                   autocomplete="off">
                                            <div class="search-input-actions">
                                                <button type="button" class="voice-search-btn" id="voiceSearchBtn" title="Voice Search">
                                                    <i class="fas fa-microphone"></i>
                                                </button>
                                                <button type="button" class="camera-search-btn" id="cameraSearchBtn" title="Search by Image">
                                                    <i class="fas fa-camera"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- AI Suggestions with Smart Auto-Complete -->
                                        <div id="aiSuggestions" class="ai-suggestions-dropdown d-none">
                                            <div class="suggestions-header">
                                                <div class="ai-thinking">
                                                    <div class="thinking-dots">
                                                        <span></span><span></span><span></span>
                                                    </div>
                                                    <span class="thinking-text">AI is analyzing your preferences...</span>
                                                </div>
                                            </div>
                                            <div class="suggestions-content">
                                                <!-- Smart suggestions will be populated here -->
                                            </div>
                                            <div class="suggestions-footer">
                                                <div class="suggestion-tips">
                                                    <span class="tip">üí° Try: "Beach vacation for 2 weeks under $3000"</span>
                                                    <span class="tip">üèîÔ∏è Or: "Mountain adventure with hiking and camping"</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Instant Smart Filters -->
                                    <div class="smart-filters-row mt-3">
                                        <div class="row g-2">
                                            <div class="col-md-3">
                                                <div class="smart-filter-group">
                                                    <label class="smart-filter-label">
                                                        <i class="fas fa-calendar-alt"></i> When?
                                                    </label>
                                                    <select class="smart-filter-select" id="whenFilter" name="when_filter">
                                                        <option value="">Select dates</option>
                                                        <option value="this_weekend">This Weekend</option>
                                                        <option value="next_week">Next Week</option>
                                                        <option value="next_month">Next Month</option>
                                                        <option value="this_summer">This Summer</option>
                                                        <option value="custom">Custom Dates</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="smart-filter-group">
                                                    <label class="smart-filter-label">
                                                        <i class="fas fa-users"></i> Who?
                                                    </label>
                                                    <select class="smart-filter-select" id="whoFilter" name="who_filter">
                                                        <option value="">Select travelers</option>
                                                        <option value="solo">Solo Traveler</option>
                                                        <option value="couple">Couple</option>
                                                        <option value="family">Family</option>
                                                        <option value="friends">Friends Group</option>
                                                        <option value="business">Business Trip</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="smart-filter-group">
                                                    <label class="smart-filter-label">
                                                        <i class="fas fa-wallet"></i> Budget
                                                    </label>
                                                    <select class="smart-filter-select" id="budgetFilter" name="budget_filter">
                                                        <option value="">Any budget</option>
                                                        <option value="budget">Budget ($100-$500)</option>
                                                        <option value="mid">Mid-range ($500-$1500)</option>
                                                        <option value="premium">Premium ($1500-$3000)</option>
                                                        <option value="luxury">Luxury ($3000+)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="smart-filter-group">
                                                    <label class="smart-filter-label">
                                                        <i class="fas fa-compass"></i> Vibe
                                                    </label>
                                                    <select class="smart-filter-select" id="vibeFilter" name="vibe_filter">
                                                        <option value="">Any style</option>
                                                        <option value="adventure">Adventure</option>
                                                        <option value="relaxation">Relaxation</option>
                                                        <option value="cultural">Cultural</option>
                                                        <option value="romantic">Romantic</option>
                                                        <option value="party">Party/Nightlife</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Enhanced Ultra-Modern Search Button -->
                            <div class="ultra-search-button-container mt-4">
                                <button type="submit" class="ultra-search-btn" id="ultraSearchBtn">
                                    <span class="btn-content">
                                        <div class="btn-icon-container">
                                            <i class="fas fa-rocket btn-icon"></i>
                                        </div>
                                        <span class="btn-text">Discover Amazing Places</span>
                                        <div class="btn-arrow">
                                            <i class="fas fa-arrow-right"></i>
                                        </div>
                                    </span>
                                    <div class="btn-loading d-none">
                                        <div class="loading-ripple">
                                            <div></div>
                                            <div></div>
                                        </div>
                                        <span>Finding perfect matches...</span>
                                    </div>
                                    <div class="btn-particles">
                                        <span class="particle"></span>
                                        <span class="particle"></span>
                                        <span class="particle"></span>
                                        <span class="particle"></span>
                                        <span class="particle"></span>
                                    </div>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    </div>
</div>

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <h2><i class="fas fa-star text-warning"></i> Featured Packages</h2>
        <a href="{% url 'package_list' %}" class="btn btn-outline-success">View All Packages</a>
    </div>
    
    {% if featured_packages %}
        <div class="row">
            {% for package in featured_packages %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100 shadow-sm">
                        <div class="position-relative">
                            <span class="badge bg-warning position-absolute top-0 start-0 m-2 z-index-1">
                                <i class="fas fa-star"></i> Featured
                            </span>
                            {% if package.image %}
                                <img src="{{ package.image.url }}" class="card-img-top" alt="{{ package.name }}" style="height: 200px; object-fit: cover;">
                            {% else %}
                                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">{{ package.name }}</h5>
                            <p class="card-text">{{ package.description|truncatewords:20 }}</p>
                            <p class="card-text">
                                <small class="text-muted">
                                    <i class="fas fa-map-marker-alt"></i> {{ package.destination.name }}
                                </small>
                            </p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="h5 text-success">${{ package.price }}</span>
                                <div class="rating">
                                    {% for i in "12345" %}
                                    {% if forloop.counter <= package.average_rating %} <i class="fas fa-star"></i>
                                        {% else %}
                                        <i class="far fa-star"></i>
                                        {% endif %}
                                        {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="{% url 'package_detail' package.id %}" class="btn btn-success w-100">View Details</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-5">
            <i class="fas fa-star fa-4x text-muted mb-3"></i>
            <h4 class="text-muted">No Featured Packages Available</h4>
            <p class="text-muted">Our team is working on featuring amazing packages for you.</p>
            <a href="{% url 'package_list' %}" class="btn btn-success">Browse All Packages</a>
        </div>
    {% endif %}
</div>

<div class="bg-light py-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-5">
            <h2><i class="fas fa-hotel text-success"></i> Featured Hotels</h2>
            <a href="{% url 'hotels' %}" class="btn btn-outline-success">View All Hotels</a>
        </div>
        
        {% if featured_hotels %}
            <div class="row">
                {% for hotel in featured_hotels %}
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="position-relative">
                                <span class="badge bg-primary position-absolute top-0 start-0 m-2 z-index-1">
                                    <i class="fas fa-star"></i> Featured
                                </span>
                                {% if hotel.image %}
                                    <img src="{{ hotel.image.url }}" class="card-img-top" alt="{{ hotel.name }}" style="height: 200px; object-fit: cover;">
                                {% else %}
                                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                                        <i class="fas fa-hotel fa-3x text-muted"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="card-body">
                                <h5 class="card-title">{{ hotel.name }}</h5>
                                <div class="mb-2">
                                    <span class="text-warning">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= hotel.star_rating %}
                                                <i class="fas fa-star"></i>
                                            {% else %}
                                                <i class="far fa-star"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </span>
                                </div>
                                <p class="card-text">
                                    <small class="text-muted">
                                        <i class="fas fa-map-marker-alt"></i> {{ hotel.destination.name }}
                                    </small>
                                </p>
                                {% if hotel.description %}
                                    <p class="card-text">{{ hotel.description|truncatewords:15 }}</p>
                                {% endif %}
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="h5 text-success">${{ hotel.price_per_night }}/night</span>
                                    <small class="text-muted">{{ hotel.star_rating }} Star Hotel</small>
                                </div>
                            </div>
                            <div class="card-footer">
                                <a href="{% url 'hotel_detail' hotel.id %}" class="btn btn-success w-100">View Details</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-5">
                <i class="fas fa-hotel fa-4x text-muted mb-3"></i>
                <h4 class="text-muted">No Featured Hotels Available</h4>
                <p class="text-muted">We're curating the best hotels for you.</p>
                <a href="{% url 'hotels' %}" class="btn btn-success">Browse All Hotels</a>
            </div>
        {% endif %}
    </div>
</div>

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <h2><i class="fas fa-fire text-danger"></i> Popular Destinations</h2>
        <a href="{% url 'destinations' %}" class="btn btn-outline-success">View All Destinations</a>
    </div>
    
    {% if destinations %}
        <div class="row">
            {% for destination in destinations %}
                <div class="col-md-3 col-sm-6 mb-4">
                    <div class="card border-0 shadow-sm">
                        <div class="position-relative">
                            <span class="badge bg-danger position-absolute top-0 end-0 m-2 z-index-1">
                                <i class="fas fa-fire"></i> Popular
                            </span>
                            {% if destination.image %}
                                <img src="{{ destination.image.url }}" class="card-img-top rounded" alt="{{ destination.name }}" style="height: 150px; object-fit: cover;">
                            {% else %}
                                <div class="card-img-top bg-light rounded d-flex align-items-center justify-content-center" style="height: 150px;">
                                    <i class="fas fa-image fa-2x text-muted"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="card-body text-center">
                            <h6 class="card-title">{{ destination.name }}</h6>
                            <p class="card-text small text-muted">{{ destination.city }}, {{ destination.country }}</p>
                            <a href="{% url 'destination_detail' destination.id %}"
                                class="btn btn-sm btn-outline-success">Explore</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-5">
            <i class="fas fa-map-marker-alt fa-4x text-muted mb-3"></i>
            <h4 class="text-muted">No Popular Destinations Available</h4>
            <p class="text-muted">We're curating the most popular destinations for you.</p>
            <a href="{% url 'destinations' %}" class="btn btn-success">Browse All Destinations</a>
        </div>
    {% endif %}
</div>

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <h2><i class="fas fa-plane text-success"></i> Popular Transports</h2>
        <a href="{% url 'transports' %}" class="btn btn-outline-success">View All Transports</a>
    </div>
    
    {% if popular_transports %}
        <div class="row">
            {% for transport in popular_transports %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100 shadow-sm">
                        <div class="position-relative">
                            <span class="badge bg-success position-absolute top-0 start-0 m-2 z-index-1">
                                <i class="fas fa-fire"></i> Popular
                            </span>
                            {% if transport.image %}
                                <img src="{{ transport.image.url }}" class="card-img-top" alt="{{ transport.name }}" style="height: 200px; object-fit: cover;">
                            {% else %}
                                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                                    {% if transport.transport_type == 'flight' %}
                                        <i class="fas fa-plane fa-3x text-muted"></i>
                                    {% elif transport.transport_type == 'bus' %}
                                        <i class="fas fa-bus fa-3x text-muted"></i>
                                    {% elif transport.transport_type == 'train' %}
                                        <i class="fas fa-train fa-3x text-muted"></i>
                                    {% else %}
                                        <i class="fas fa-car fa-3x text-muted"></i>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">{{ transport.name }}</h5>
                            <p class="card-text">
                                <span class="badge bg-secondary">{{ transport.get_transport_type_display }}</span>
                            </p>
                            <p class="card-text">
                                <small class="text-muted">
                                    <i class="fas fa-map-marker-alt"></i> {{ transport.from_destination.name }} ‚Üí {{ transport.to_destination.name }}
                                </small>
                            </p>
                            <p class="card-text">
                                <small class="text-muted">
                                    <i class="fas fa-clock"></i> {{ transport.departure_time }} - {{ transport.arrival_time }}
                                </small>
                            </p>
                            {% if transport.description %}
                                <p class="card-text">{{ transport.description|truncatewords:15 }}</p>
                            {% endif %}
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="h5 text-success">${{ transport.price }}</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="{% url 'transport_detail' transport.id %}" class="btn btn-success w-100">View Details</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-5">
            <i class="fas fa-plane fa-4x text-muted mb-3"></i>
            <h4 class="text-muted">No Popular Transports Available</h4>
            <p class="text-muted">We're curating the best transport options for you.</p>
            <a href="{% url 'transports' %}" class="btn btn-success">Browse All Transports</a>
        </div>
    {% endif %}
</div>

<!-- Customer Testimonials Section -->
<div class="bg-light py-5 my-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-5 fw-bold mb-3">What Our Travelers Say</h2>
            <p class="lead text-muted">Real experiences from real travelers</p>
        </div>
        <div class="row">
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="testimonial-card p-4 rounded-4 shadow-sm bg-white h-100">
                    <div class="testimonial-rating mb-3">
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                    </div>
                    <p class="testimonial-text mb-4">"Amazing experience! The booking process was seamless and the destinations were exactly as advertised. Our travel consultant was incredibly helpful throughout the entire journey."</p>
                    <div class="testimonial-author d-flex align-items-center">
                        <div class="author-avatar me-3">
                            <img src="https://images.unsplash.com/photo-1494790108755-2616b612d5bb?w=60&h=60&fit=crop&crop=face" 
                                 alt="Sarah Johnson" class="rounded-circle" width="50" height="50">
                        </div>
                        <div>
                            <h6 class="mb-0">Sarah Johnson</h6>
                            <small class="text-muted">Adventure Enthusiast</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="testimonial-card p-4 rounded-4 shadow-sm bg-white h-100">
                    <div class="testimonial-rating mb-3">
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                    </div>
                    <p class="testimonial-text mb-4">"Best travel service I've ever used! The packages are well-planned, affordable, and the customer support is outstanding. Already planning my next trip with them."</p>
                    <div class="testimonial-author d-flex align-items-center">
                        <div class="author-avatar me-3">
                            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=60&h=60&fit=crop&crop=face" 
                                 alt="Michael Chen" class="rounded-circle" width="50" height="50">
                        </div>
                        <div>
                            <h6 class="mb-0">Michael Chen</h6>
                            <small class="text-muted">Business Traveler</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="testimonial-card p-4 rounded-4 shadow-sm bg-white h-100">
                    <div class="testimonial-rating mb-3">
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                        <i class="fas fa-star text-warning"></i>
                    </div>
                    <p class="testimonial-text mb-4">"Family vacation made easy! They took care of everything from flights to accommodations. The kids loved every moment and we created memories that will last a lifetime."</p>
                    <div class="testimonial-author d-flex align-items-center">
                        <div class="author-avatar me-3">
                            <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=60&h=60&fit=crop&crop=face" 
                                 alt="Emily Rodriguez" class="rounded-circle" width="50" height="50">
                        </div>
                        <div>
                            <h6 class="mb-0">Emily Rodriguez</h6>
                            <small class="text-muted">Family Traveler</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Travel Tips Blog Section -->
<div class="container my-5">
    <div class="text-center mb-5">
        <h2 class="display-5 fw-bold mb-3">Travel Tips & Guides</h2>
        <p class="lead text-muted">Expert advice to make your travels unforgettable</p>
    </div>
    <div class="row">
        <div class="col-lg-4 col-md-6 mb-4">
            <article class="blog-card rounded-4 overflow-hidden shadow-sm h-100">
                <div class="blog-image">
                    <img src="https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400&h=250&fit=crop" 
                         alt="Packing Tips" class="w-100" style="height: 200px; object-fit: cover;">
                    <div class="blog-category position-absolute top-0 start-0 m-3">
                        <span class="badge bg-primary">Travel Tips</span>
                    </div>
                </div>
                <div class="blog-content p-4 bg-white">
                    <h5 class="blog-title mb-3">10 Essential Packing Tips for Any Destination</h5>
                    <p class="blog-excerpt text-muted mb-3">Learn how to pack smart and travel light with these expert packing tips that will save you space and hassle.</p>
                    <div class="blog-meta d-flex justify-content-between align-items-center">
                        <small class="text-muted"><i class="fas fa-calendar me-1"></i>Dec 15, 2024</small>
                        <a href="#" class="btn btn-sm btn-outline-primary">Read More</a>
                    </div>
                </div>
            </article>
        </div>
        <div class="col-lg-4 col-md-6 mb-4">
            <article class="blog-card rounded-4 overflow-hidden shadow-sm h-100">
                <div class="blog-image">
                    <img src="https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=250&fit=crop" 
                         alt="Budget Travel" class="w-100" style="height: 200px; object-fit: cover;">
                    <div class="blog-category position-absolute top-0 start-0 m-3">
                        <span class="badge bg-success">Budget Travel</span>
                    </div>
                </div>
                <div class="blog-content p-4 bg-white">
                    <h5 class="blog-title mb-3">How to Travel the World on a Budget</h5>
                    <p class="blog-excerpt text-muted mb-3">Discover proven strategies to explore amazing destinations without breaking the bank.</p>
                    <div class="blog-meta d-flex justify-content-between align-items-center">
                        <small class="text-muted"><i class="fas fa-calendar me-1"></i>Dec 10, 2024</small>
                        <a href="#" class="btn btn-sm btn-outline-primary">Read More</a>
                    </div>
                </div>
            </article>
        </div>
        <div class="col-lg-4 col-md-6 mb-4">
            <article class="blog-card rounded-4 overflow-hidden shadow-sm h-100">
                <div class="blog-image">
                    <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=250&fit=crop" 
                         alt="Solo Travel" class="w-100" style="height: 200px; object-fit: cover;">
                    <div class="blog-category position-absolute top-0 start-0 m-3">
                        <span class="badge bg-warning">Solo Travel</span>
                    </div>
                </div>
                <div class="blog-content p-4 bg-white">
                    <h5 class="blog-title mb-3">Solo Travel Safety Guide</h5>
                    <p class="blog-excerpt text-muted mb-3">Essential safety tips and advice for confident solo travelers exploring new destinations.</p>
                    <div class="blog-meta d-flex justify-content-between align-items-center">
                        <small class="text-muted"><i class="fas fa-calendar me-1"></i>Dec 5, 2024</small>
                        <a href="#" class="btn btn-sm btn-outline-primary">Read More</a>
                    </div>
                </div>
            </article>
        </div>
    </div>
    <div class="text-center mt-4">
        <a href="#" class="btn btn-outline-primary btn-lg">
            <i class="fas fa-blog me-2"></i>Visit Our Blog
        </a>
    </div>
</div>

<!-- ...existing code for packages, hotels, destinations, transports... -->
{% endblock %}

{% block extra_js %}
<script>
// Enhanced destination suggestions with fuzzy search
const destinations = [
    {% for dest in all_destinations %}
        {
            full: "{{ dest.name }}, {{ dest.city }}, {{ dest.country }}"
        },
    {% endfor %}
];

// Global variables
let searchTimeout;
let selectedSuggestionIndex = -1;
let currentSearchMode = 'quick';

// Enhanced search functionality with keyword matching
class SearchManager {
    constructor() {
        this.searchInput = document.getElementById('aiDestination');
        this.suggestionsContainer = document.getElementById('aiSuggestions');
        this.searchForm = document.getElementById('modernSearchForm');
        this.currentQuery = '';
        this.debounceTimer = null;
        
        this.initializeEventListeners();
    }
    
    initializeEventListeners() {
        // Search input events
        if (this.searchInput) {
            this.searchInput.addEventListener('input', (e) => this.handleSearchInput(e));
            this.searchInput.addEventListener('keydown', (e) => this.handleKeyDown(e));
            this.searchInput.addEventListener('focus', () => this.showSuggestions());
            this.searchInput.addEventListener('blur', () => this.hideSuggestions());
        }
        
        // Form submission
        if (this.searchForm) {
            this.searchForm.addEventListener('submit', (e) => this.handleFormSubmit(e));
        }
        
        // Quick filter buttons
        document.querySelectorAll('.quick-filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => this.handleQuickFilter(e));
        });
    }
    
    handleSearchInput(e) {
        this.currentQuery = e.target.value;
        
        // Clear previous timer
        if (this.debounceTimer) {
            clearTimeout(this.debounceTimer);
        }
        
        // Debounce search requests
        this.debounceTimer = setTimeout(() => {
            if (this.currentQuery.length >= 2) {
                this.fetchSuggestions(this.currentQuery);
            } else {
                this.hideSuggestions();
            }
        }, 300);
    }
    
    async fetchSuggestions(query) {
        try {
            const response = await fetch(`/api/search/autocomplete/?q=${encodeURIComponent(query)}&limit=8`);
            const data = await response.json();
            
            if (data.suggestions && data.suggestions.length > 0) {
                this.displaySuggestions(data.suggestions);
            } else {
                this.hideSuggestions();
            }
        } catch (error) {
            console.error('Error fetching suggestions:', error);
            this.hideSuggestions();
        }
    }
    
    displaySuggestions(suggestions) {
        if (!this.suggestionsContainer) return;
        
        const suggestionsContent = this.suggestionsContainer.querySelector('.suggestions-content');
        if (!suggestionsContent) return;
        
        suggestionsContent.innerHTML = '';
        
        suggestions.forEach((suggestion, index) => {
            const suggestionElement = document.createElement('div');
            suggestionElement.className = 'suggestion-item';
            suggestionElement.innerHTML = `
                <div class="suggestion-content">
                    <div class="suggestion-icon">
                        <i class="fas fa-${this.getSuggestionIcon(suggestion.type)}"></i>
                    </div>
                    <div class="suggestion-text">
                        <div class="suggestion-title">${suggestion.text}</div>
                        <div class="suggestion-subtitle">${this.getSuggestionSubtitle(suggestion)}</div>
                    </div>
                </div>
            `;
            
            suggestionElement.addEventListener('click', () => this.selectSuggestion(suggestion));
            suggestionsContent.appendChild(suggestionElement);
        });
        
        this.showSuggestions();
    }
    
    getSuggestionIcon(type) {
        const icons = {
            'package': 'suitcase',
            'destination': 'map-marker-alt',
            'hotel': 'bed',
            'transport': 'plane'
        };
        return icons[type] || 'search';
    }
    
    getSuggestionSubtitle(suggestion) {
        if (suggestion.type === 'package') {
            return `${suggestion.destination} - $${suggestion.price}`;
        } else if (suggestion.type === 'destination') {
            return `${suggestion.packages_count} packages available`;
        }
        return suggestion.destination || '';
    }
    
    selectSuggestion(suggestion) {
        this.searchInput.value = suggestion.text;
        this.hideSuggestions();
        
        // Auto-fill related fields based on suggestion type
        if (suggestion.type === 'destination') {
            this.autoFillDestination(suggestion);
        } else if (suggestion.type === 'package') {
            this.autoFillPackage(suggestion);
        }
        
        // Submit form
        setTimeout(() => {
            this.searchForm.submit();
        }, 100);
    }
    
    autoFillDestination(suggestion) {
        const smartFilters = {
            'vibeFilter': 'cultural',
            'budgetFilter': 'mid'
        };
        
        Object.entries(smartFilters).forEach(([filterId, value]) => {
            const element = document.getElementById(filterId);
            if (element) {
                element.value = value;
            }
        });
    }
    
    autoFillPackage(suggestion) {
        // Auto-fill budget based on package price
        const budgetFilter = document.getElementById('budgetFilter');
        if (budgetFilter && suggestion.price) {
            const price = parseFloat(suggestion.price);
            if (price < 500) {
                budgetFilter.value = 'budget';
            } else if (price < 1500) {
                budgetFilter.value = 'mid';
            } else if (price < 3000) {
                budgetFilter.value = 'premium';
            } else {
                budgetFilter.value = 'luxury';
            }
        }
    }
    
    showSuggestions() {
        if (this.suggestionsContainer) {
            this.suggestionsContainer.classList.remove('d-none');
        }
    }
    
    hideSuggestions() {
        setTimeout(() => {
            if (this.suggestionsContainer) {
                this.suggestionsContainer.classList.add('d-none');
            }
        }, 200);
    }
    
    handleKeyDown(e) {
        const suggestions = this.suggestionsContainer?.querySelectorAll('.suggestion-item');
        if (!suggestions || suggestions.length === 0) return;
        
        switch (e.key) {
            case 'ArrowDown':
                e.preventDefault();
                this.selectedSuggestionIndex = Math.min(this.selectedSuggestionIndex + 1, suggestions.length - 1);
                this.highlightSuggestion(suggestions);
                break;
            case 'ArrowUp':
                e.preventDefault();
                this.selectedSuggestionIndex = Math.max(this.selectedSuggestionIndex - 1, -1);
                this.highlightSuggestion(suggestions);
                break;
            case 'Enter':
                if (this.selectedSuggestionIndex >= 0) {
                    e.preventDefault();
                    suggestions[this.selectedSuggestionIndex].click();
                }
                break;
            case 'Escape':
                this.hideSuggestions();
                break;
        }
    }
    
    highlightSuggestion(suggestions) {
        suggestions.forEach((suggestion, index) => {
            suggestion.classList.toggle('highlighted', index === this.selectedSuggestionIndex);
        });
    }
    
    handleFormSubmit(e) {
        // Show loading state
        const submitButton = document.getElementById('ultraSearchBtn');
        if (submitButton) {
            const btnContent = submitButton.querySelector('.btn-content');
            const btnLoading = submitButton.querySelector('.btn-loading');
            
            if (btnContent && btnLoading) {
                btnContent.classList.add('d-none');
                btnLoading.classList.remove('d-none');
            }
        }
        
        // Let form submit normally
        return true;
    }
    
    handleQuickFilter(e) {
        const filterType = e.currentTarget.dataset.filter;
        
        // Update search query with filter
        if (this.searchInput) {
            this.searchInput.value = filterType + ' travel experience';
        }
        
        // Auto-fill smart filters
        const vibeFilter = document.getElementById('vibeFilter');
        if (vibeFilter) {
            vibeFilter.value = filterType;
        }
        
        // Submit form
        setTimeout(() => {
            this.searchForm.submit();
        }, 100);
    }
}

// Voice Search Functionality
class VoiceSearch {
    constructor() {
        this.recognition = null;
        this.isListening = false;
        this.voiceButton = document.getElementById('voiceSearchBtn');
        
        this.initializeVoiceSearch();
    }
    
    initializeVoiceSearch() {
        if ('webkitSpeechRecognition' in window) {
            this.recognition = new webkitSpeechRecognition();
            this.recognition.continuous = false;
            this.recognition.interimResults = false;
            this.recognition.lang = 'en-US';
            
            this.recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                this.handleVoiceResult(transcript);
            };
            
            this.recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                this.stopListening();
            };
            
            this.recognition.onend = () => {
                this.stopListening();
            };
        } else {
            // Hide voice search button if not supported
            if (this.voiceButton) {
                this.voiceButton.style.display = 'none';
            }
        }
        
        if (this.voiceButton) {
            this.voiceButton.addEventListener('click', () => this.toggleVoiceSearch());
        }
    }
    
    toggleVoiceSearch() {
        if (this.isListening) {
            this.stopListening();
        } else {
            this.startListening();
        }
    }
    
    startListening() {
        if (!this.recognition) return;
        
        this.isListening = true;
        this.voiceButton.classList.add('listening');
        this.voiceButton.innerHTML = '<i class="fas fa-microphone-slash"></i>';
        
        this.recognition.start();
    }
    
    stopListening() {
        this.isListening = false;
        if (this.voiceButton) {
            this.voiceButton.classList.remove('listening');
            this.voiceButton.innerHTML = '<i class="fas fa-microphone"></i>';
        }
        
        if (this.recognition) {
            this.recognition.stop();
        }
    }
    
    handleVoiceResult(transcript) {
        const searchInput = document.getElementById('aiDestination');
        if (searchInput) {
            searchInput.value = transcript;
            searchInput.dispatchEvent(new Event('input'));
        }
    }
}

// Trending tags functionality
function setDestination(destination) {
    const searchInput = document.getElementById('aiDestination');
    if (searchInput) {
        searchInput.value = destination;
        searchInput.dispatchEvent(new Event('input'));
    }
}

function setQuickFilter(filterType) {
    const searchInput = document.getElementById('aiDestination');
    if (searchInput) {
        searchInput.value = filterType + ' travel experience';
        searchInput.dispatchEvent(new Event('input'));
    }
    
    // Auto-fill related filters
    const vibeFilter = document.getElementById('vibeFilter');
    if (vibeFilter) {
        vibeFilter.value = filterType;
    }
    
    // Submit form
    setTimeout(() => {
        document.getElementById('modernSearchForm').submit();
    }, 100);
}

// Counter animation for statistics
function animateCounters() {
    const counters = document.querySelectorAll('[data-counter]');
    
    const observerOptions = {
        threshold: 0.5,
        rootMargin: '0px'
    };
    
    const counterObserver = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const counter = entry.target;
                const target = parseInt(counter.dataset.counter);
                const duration = 2000;
                const start = performance.now();
                
                const animate = (currentTime) => {
                    const elapsed = currentTime - start;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const current = Math.floor(progress * target);
                    counter.textContent = current.toLocaleString();
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                
                requestAnimationFrame(animate);
                counterObserver.unobserve(counter);
            }
        });
    }, observerOptions);
    
    counters.forEach(counter => {
        counterObserver.observe(counter);
    });
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Initialize search manager
    const searchManager = new SearchManager();
    
    // Initialize voice search
    const voiceSearch = new VoiceSearch();
    
    // Initialize counter animation
    animateCounters();
    
    // Initialize travelers/budget controls
    initializeTravelersControls();
    initializeBudgetControls();
    
    // Initialize date validation
    initializeDateValidation();
});

// Travelers counter functions
function changeTravelers(type, change) {
    const input = document.getElementById(type);
    if (input) {
        const currentValue = parseInt(input.value) || 0;
        const newValue = Math.max(type === 'adults' ? 1 : 0, currentValue + change);
        input.value = newValue;
        updateTravelersDisplay();
    }
}

function updateTravelersDisplay() {
    const adults = parseInt(document.getElementById('adults')?.value) || 2;
    const children = parseInt(document.getElementById('children')?.value) || 0;
    const minPrice = parseInt(document.getElementById('min_price')?.value) || 100;
    const maxPrice = parseInt(document.getElementById('max_price')?.value) || 1000;
    
    const displayText = `${adults} Adult${adults > 1 ? 's' : ''}${children > 0 ? ` ‚Ä¢ ${children} Child${children > 1 ? 'ren' : ''}` : ''} ‚Ä¢ $${minPrice}-$${maxPrice}`;
    
    const display = document.getElementById('travelersBudgetText');
    if (display) {
        display.textContent = displayText;
    }
}

// Budget functions
function setBudgetPreset(min, max) {
    const minInput = document.getElementById('min_price');
    const maxInput = document.getElementById('max_price');
    const slider = document.getElementById('budgetRange');
    
    if (minInput) minInput.value = min;
    if (maxInput) maxInput.value = max;
    if (slider) slider.value = max;
    
    updateTravelersDisplay();
}

function initializeTravelersControls() {
    // Initialize display
    updateTravelersDisplay();
}

function initializeBudgetControls() {
    const budgetSlider = document.getElementById('budgetRange');
    const maxPriceInput = document.getElementById('max_price');
    
    if (budgetSlider && maxPriceInput) {
        budgetSlider.addEventListener('input', function() {
            maxPriceInput.value = this.value;
            updateTravelersDisplay();
        });
        
        maxPriceInput.addEventListener('input', function() {
            budgetSlider.value = this.value;
            updateTravelersDisplay();
        });
    }
}

function initializeDateValidation() {
    const startDateInput = document.getElementById('start_date');
    const endDateInput = document.getElementById('end_date');
    
    if (startDateInput && endDateInput) {
        startDateInput.addEventListener('change', function() {
            endDateInput.min = this.value;
            if (endDateInput.value && endDateInput.value < this.value) {
                endDateInput.value = this.value;
            }
        });
    }
}
</script>
{% endblock %}